<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lusofy - Beta 1.3</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* === Tema base (sem mudanças estruturais) === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-primary: #041f43;
      --bg-secondary: #062a5a;
      --bg-card: #0a3570;
      --bg-column: #031632;
      --text-primary: #ffffff;
      --text-secondary: #b8c7db;
      --text-muted: #7a8fa8;
      --border-color: #1a4a7a;
      --accent: #ffcf00;
      --accent-hover: #ffe14d;
    }
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      transition: all 0.3s ease;
    }

    /* === Modo diurno === */
    body.light-theme {
      --bg-primary: #f0f4f8;
      --bg-secondary: #e2e8f0;
      --bg-column: #f8fafc;
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --border-color: #cbd5e1;
      --accent: #041f43;
      --accent-hover: #062a5a;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    }
    body.light-theme .dashboard-card,
    body.light-theme .kanban-column,
    body.light-theme .chart-card {
      background: linear-gradient(145deg, #c3d3f9, #e4ebfa);
    }

    /* === Cabeçalho === */
    .header {
      background: rgba(4, 31, 67, 0.98);
      border-bottom: 3px solid var(--accent);
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 100;
    }
    .header-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-logo h1 {
      font-family: 'Oswald', sans-serif;
      font-size: 1.8rem;
      color: var(--accent);
      letter-spacing: 2px;
    }
    .version {
      font-size: 0.75rem;
      color: var(--text-muted);
      background: var(--bg-card);
      padding: 4px 10px;
      border-radius: 4px;
      font-weight: 600;
    }
    .header-nav {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-left: 24px;
    }
    .header-nav a {
      color: var(--text-secondary);
      text-decoration: none;
      font-family: 'Oswald', sans-serif;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: color 0.2s;
    }
    .header-nav a:hover { color: var(--accent); }

    /* === Gráficos === */
    .charts-section {
      background: var(--bg-column);
      margin-top: 70px;
      padding: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      border-bottom: 1px solid var(--border-color);
    }
    .chart-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
    }
    .chart-card h3 {
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      color: var(--accent);
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    /* === Dashboard === */
    .dashboard {
      background: var(--bg-column);
      border-bottom: 1px solid var(--border-color);
      padding: 16px 24px;
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    .dashboard-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid var(--border-color);
    }
    .dashboard-card-title {
      font-family: 'Oswald', sans-serif;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .dashboard-card-value {
      font-family: 'Oswald', sans-serif;
      font-size: 2rem;
      color: var(--accent);
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="header-logo">
      <h1>LUSOFY</h1>
      <span class="version">Beta 1.3</span>
    </div>
    <nav class="header-nav">
      <a href="#">Faturamento</a>
      <a href="#">Financeiro</a>
      <a href="#">Meu Perfil</a>
    </nav>
  </header>

  <!-- === Seção de Gráficos === -->
  <section class="charts-section">
    <div class="chart-card">
      <h3>Conclusões por Dia</h3>
      <canvas id="chartConclusoesDia"></canvas>
    </div>
    <div class="chart-card">
      <h3>Conclusões por Responsável</h3>
      <canvas id="chartConclusoesResp"></canvas>
    </div>
    <div class="chart-card">
      <h3>Pendentes por Responsável</h3>
      <canvas id="chartPendentesResp"></canvas>
    </div>
  </section>

  <!-- === Dashboard existente === -->
  <div class="dashboard">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <div class="dashboard-card-title">Total de Tarefas</div>
        <div class="dashboard-card-value" id="dashTotalTasks">0</div>
        <div class="dashboard-card-subtitle">tarefas ativas</div>
      </div>
      <div class="dashboard-card status-card">
        <div class="dashboard-card-title">Por Status</div>
        <div class="status-row">
          <span>Não Iniciado</span> <span id="dashNaoIniciado">0</span>
        </div>
        <div class="status-row">
          <span>Em Andamento</span> <span id="dashEmAndamento">0</span>
        </div>
        <div class="status-row">
          <span>Bloqueado</span> <span id="dashBloqueado">0</span>
        </div>
        <div class="status-row">
          <span>Concluídos Recentes</span> <span id="dashConcluido">0</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* === Dados simulados de tarefas (para teste) === */
    let tasks = [
      { nome: "Tarefa 1", status: "concluido", responsavel: "Ana", concluidoEm: "2026-01-01" },
      { nome: "Tarefa 2", status: "concluido", responsavel: "João", concluidoEm: "2026-01-02" },
      { nome: "Tarefa 3", status: "em_andamento", responsavel: "Ana" },
      { nome: "Tarefa 4", status: "nao_iniciado", responsavel: "Carlos" },
      { nome: "Tarefa 5", status: "concluido", responsavel: "Ana", concluidoEm: "2026-01-03" },
      { nome: "Tarefa 6", status: "bloqueado", responsavel: "João" },
    ];

    /* === Busca === */
    function handleSearch(q) {
      q = q.toLowerCase();
      const resultados = tasks.filter(t =>
        t.nome.toLowerCase().includes(q) || (t.descricao || "").toLowerCase().includes(q)
      );
      console.log("Resultados da busca:", resultados);
      return resultados;
    }

    /* === Gráficos com Chart.js === */
    function atualizarGraficos() {
      const concluidas = tasks.filter(t => t.status === "concluido");
      const pendentes = tasks.filter(t => t.status !== "concluido");

      const concluidasPorDia = {};
      concluidas.forEach(t => {
        const dia = new Date(t.concluidoEm).toLocaleDateString("pt-BR");
        concluidasPorDia[dia] = (concluidasPorDia[dia] || 0) + 1;
      });

      const concluidasPorResp = {};
      const pendentesPorResp = {};
      tasks.forEach(t => {
        const r = t.responsavel || "Sem responsável";
        if (t.status === "concluido")
          concluidasPorResp[r] = (concluidasPorResp[r] || 0) + 1;
        else pendentesPorResp[r] = (pendentesPorResp[r] || 0) + 1;
      });

      const ctxDia = document.getElementById("chartConclusoesDia").getContext("2d");
      const ctxResp = document.getElementById("chartConclusoesResp").getContext("2d");
      const ctxPend = document.getElementById("chartPendentesResp").getContext("2d");

      new Chart(ctxDia, {
        type: "line",
        data: {
          labels: Object.keys(concluidasPorDia),
          datasets: [
            {
              label: "Tarefas Concluídas",
              data: Object.values(concluidasPorDia),
              borderColor: "#ffcf00",
              backgroundColor: "rgba(255,207,0,0.3)",
              fill: true,
              tension: 0.3,
            },
          ],
        },
        options: { responsive: true, plugins: { legend: { display: false } } },
      });

      new Chart(ctxResp, {
        type: "pie",
        data: {
          labels: Object.keys(concluidasPorResp),
          datasets: [
            {
              data: Object.values(concluidasPorResp),
              backgroundColor: ["#f59e0b", "#3b82f6", "#10b981", "#ef4444"],
            },
          ],
        },
        options: { responsive: true },
      });

      new Chart(ctxPend, {
        type: "bar",
        data: {
          labels: Object.keys(pendentesPorResp),
          datasets: [
            {
              label: "Pendentes",
              data: Object.values(pendentesPorResp),
              backgroundColor: "#041f43",
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } },
        },
      });
    }

    document.addEventListener("DOMContentLoaded", atualizarGraficos);
  </script>
</body>
</html>
